name: Release
on:
  push:
    branches:
      - 'main'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - uses: actions/setup-python@master
        with:
          python-version: '3.x'
      - uses: actions/setup-node@v1
        with:
          node-version: 12
      - name: Install Node.js dependencies
        run: npm ci
      - name: Run linters
        uses: wearerequired/lint-action@v2
        with:
          eslint: true
          prettier: true
      - run: python ./.github/scripts/make_db.py
      - name: Bump Version
        id: bump_version
        run: python ./.github/scripts/bump_version.py
      - name: Create Archive Release
        uses: thedoctor0/zip-release@master
        with:
          filename: 'module.zip'
          exclusions: '*.git*'
      - name: Automatic Release Upload
        id: automatic_release
        uses: 'marvinpinto/action-automatic-releases@latest'
        with:
          repo_token: '${{ secrets.GITHUB_TOKEN }}'
          automatic_release_tag: ${{ steps.bump_version.outputs.version }}
          prerelease: false
          title: ${{ steps.bump_version.outputs.version }}
          files: |
            module.json
            module.zip
